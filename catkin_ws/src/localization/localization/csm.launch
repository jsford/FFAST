<launch>
    
    <!-- EKF -->
    <arg name="use_ekf" default="true" />
    <arg name="ekf_tf" default="false" />
    <group if="$(arg use_ekf)">
        <include file="$(find robot_pose_ekf)/robot_pose_ekf.launch">
            <arg name="base_footprint_frame" value="base_link" if="$(arg ekf_tf)" />
            <arg name="odom_used" value="true" />
            <arg name="imu_used" value="true" />
            <arg name="vo_used" value="false" />
            <arg name="remap_frame" value="odom" />
            <arg name="remap_imu" value="imu" />
        </include>
    </group>
    
    <!-- Laser Scan Matcher -->
    <arg name="use_scan_matcher" default="true" />
    <!-- Combine map and odom frames to view both in rviz (because scan matcher tf map to base_link directly). Then set either ekf_tf here to true or odom_tf in hardware.launch to true -->
    <arg name="combine_frames" default="false" />
    <arg name="scan_matcher_tf" default="true" />
    
    <group if="$(arg use_scan_matcher)">
    
        <node
            name="scan_matcher" pkg="laser_scan_matcher" type="laser_scan_matcher_node" output="screen">
            <param name="fixed_frame" value="map" />
            <param name="use_imu" value="true" />
            <param name="use_odom" value="true" />
            <param name="use_vel" value="false" />
            <param name="publish_tf" value="false" unless="$(arg scan_matcher_tf)" />
            <param name="publish_tf" value="false" if="$(arg combine_frames)" />
            <param name="publish_pose" value="false" />
            <param name="publish_pose_stamped" value="true" />
            <remap from="odom" to="robot_pose_ekf/odom_combined" if="$(arg use_ekf)" />
            <remap from="imu/data" to="imu" />
            <remap from="pose_stamped" to="laser_scan_matcher/pose" />
        </node>
    
        <node name="tf_combine_frames" pkg="tf_broadcaster" type="tf_combine_frames" output="screen" if="$(arg combine_frames)" />
        
    </group>

    
</launch>
